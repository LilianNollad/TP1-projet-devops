[SERVICE]
    Flush         5
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf

# INPUT: Lire les logs de l'application depuis le volume partag√©
[INPUT]
    Name              tail
    Path              /var/logs/crud/app.log
    Tag               crud.app
    Parser            json
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Read_from_Head    False
    Skip_Empty_Lines  On

# FILTER: Extraire les champs avant de filtrer
[FILTER]
    Name                nest
    Match               crud.app
    Operation           lift
    Nested_under        context

# FILTER: Ne garder que message et les champs de context
[FILTER]
    Name                record_modifier
    Match               crud.app
    Allowlist_key       message
    Allowlist_key       endpoint
    Allowlist_key       method
    Allowlist_key       status
    Allowlist_key       uuid
    Allowlist_key       count
    Allowlist_key       data
    Allowlist_key       error
    Allowlist_key       errors

# OUTPUT: Envoyer vers Loki sur GCP
[OUTPUT]
    Name                loki
    Match               crud.*
    Host                ${LOKI_HOST}
    Port                ${LOKI_PORT}
    Labels              job=${LOKI_JOB}, environment=${LOKI_ENVIRONMENT}, source=${LOKI_SOURCE}
    Line_format         json
    Auto_Kubernetes_Labels off
